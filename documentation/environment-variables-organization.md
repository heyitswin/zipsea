# Environment Variables Organization Strategy

## Shared Environment Groups (Use Env Groups)

### 1. **Third-Party API Credentials Group** (`zipsea-api-keys`)
These are shared across staging and production but with different values:
```bash
# Clerk Authentication
CLERK_SECRET_KEY=sk_test_... (staging) / sk_live_... (production)
CLERK_PUBLISHABLE_KEY=pk_test_... (staging) / pk_live_... (production)

# Traveltek Integration
TRAVELTEK_FTP_HOST=ftpeu1prod.traveltek.net
TRAVELTEK_FTP_USER=your_username
TRAVELTEK_FTP_PASSWORD=your_password

# Optional Services
SENTRY_DSN=https://...@sentry.io/...
RESEND_API_KEY=re_...
```

**Why in shared group:**
- Same credentials might be used across multiple services (backend, workers, etc.)
- Easier to rotate/update in one place
- Can have different groups for staging vs production

### 2. **Application Secrets Group** (`zipsea-secrets`)
```bash
JWT_SECRET=<generated-value>
WEBHOOK_SECRET=<generated-value>
```

**Why in shared group:**
- Multiple services might need to validate JWTs
- Webhook secret might be needed by multiple endpoints
- Ensures consistency across services

## Service-Specific Variables (On Web Service)

### 1. **Infrastructure/Runtime Configuration**
```bash
NODE_ENV=staging or production
PORT=10000
LOG_LEVEL=info (staging) / warn (production)
```

**Why service-specific:**
- Different services might run on different ports
- Log levels vary by environment and service type
- NODE_ENV is environment-specific

### 2. **Auto-Generated Database/Redis URLs**
```bash
DATABASE_URL=<auto-generated-by-render>
REDIS_URL=<auto-generated-by-render>
```

**Why service-specific:**
- Automatically injected by Render
- Tied to specific database/Redis instances
- Different for staging vs production

### 3. **Service Behavior Configuration**
```bash
CORS_ORIGIN=http://localhost:3000,https://zipsea-staging.vercel.app
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
CACHE_TTL_SEARCH=3600
CACHE_TTL_CRUISE_DETAILS=21600
CACHE_TTL_PRICING=900
```

**Why service-specific:**
- May vary between services (API vs worker)
- Different limits for staging vs production
- CORS specific to frontend URLs

## Recommended Render Setup

### Step 1: Create Environment Groups

**Group 1: `zipsea-staging-secrets`**
```yaml
CLERK_SECRET_KEY=sk_test_...
CLERK_PUBLISHABLE_KEY=pk_test_...
TRAVELTEK_FTP_USER=staging_user
TRAVELTEK_FTP_PASSWORD=staging_pass
JWT_SECRET=<generate-random>
WEBHOOK_SECRET=<generate-random>
```

**Group 2: `zipsea-production-secrets`** (when ready)
```yaml
CLERK_SECRET_KEY=sk_live_...
CLERK_PUBLISHABLE_KEY=pk_live_...
TRAVELTEK_FTP_USER=production_user
TRAVELTEK_FTP_PASSWORD=production_pass
JWT_SECRET=<different-random>
WEBHOOK_SECRET=<different-random>
```

**Group 3: `zipsea-shared-config`**
```yaml
TRAVELTEK_FTP_HOST=ftpeu1prod.traveltek.net
# Other shared non-sensitive config
```

### Step 2: Link Groups to Services

In your `render.yaml`:
```yaml
services:
  - type: web
    name: zipsea-backend
    envVarGroups:
      - zipsea-staging-secrets
      - zipsea-shared-config
    envVars:
      # Service-specific only
      - key: NODE_ENV
        value: staging
      - key: PORT
        value: 10000
      - key: CORS_ORIGIN
        value: http://localhost:3000
      - key: LOG_LEVEL
        value: info
      # ... other service-specific vars
```

## Quick Decision Tree

**Should this go in a shared group?**

1. **Is it a third-party API key/secret?** → Yes, shared group
2. **Will multiple services need this value?** → Yes, shared group
3. **Is it sensitive and needs rotation?** → Yes, shared group
4. **Is it auto-generated by Render?** → No, service-specific
5. **Is it about service behavior/limits?** → No, service-specific
6. **Is it environment-specific config?** → No, service-specific

## Benefits of This Approach

### Shared Groups Benefits:
- **Single source of truth** for API credentials
- **Easy rotation** - update once, all services get it
- **Consistent secrets** across services
- **Separation of concerns** - staging vs production groups

### Service-Specific Benefits:
- **Fine-tuned control** per service
- **Different configurations** for different service types
- **Clear ownership** of configuration
- **No accidental sharing** of service-specific settings

## Implementation Steps for Zipsea

### Immediate Actions:

1. **Create `zipsea-staging-secrets` group in Render:**
   - Add Clerk keys when you have them
   - Add Traveltek credentials when provided
   - Move JWT_SECRET and WEBHOOK_SECRET here

2. **Keep on service directly:**
   - NODE_ENV, PORT, CORS_ORIGIN
   - LOG_LEVEL, rate limiting settings
   - Cache TTL settings

3. **Link the group to your service:**
   - Go to service settings
   - Add environment group
   - Select `zipsea-staging-secrets`

### Future Production Setup:

1. Create `zipsea-production-secrets` group
2. Use production API keys
3. Link to production service only

## Example: How to Create an Env Group in Render

1. Go to Render Dashboard
2. Click "Env Groups" in sidebar
3. Click "New Environment Group"
4. Name: `zipsea-staging-secrets`
5. Add variables:
   ```
   CLERK_SECRET_KEY = sk_test_...
   CLERK_PUBLISHABLE_KEY = pk_test_...
   ```
6. Save group
7. Go to your service (`zipsea-backend`)
8. Settings → Linked Environment Groups
9. Add `zipsea-staging-secrets`
10. Service will redeploy with new variables

## Summary

### Put in Shared Env Groups:
- ✅ API keys (Clerk, Traveltek, Sentry, Resend)
- ✅ Shared secrets (JWT_SECRET, WEBHOOK_SECRET)
- ✅ Common configuration across services

### Keep Service-Specific:
- ✅ NODE_ENV, PORT
- ✅ CORS_ORIGIN
- ✅ Rate limits, cache TTLs
- ✅ Log levels
- ✅ Database/Redis URLs (auto-generated)