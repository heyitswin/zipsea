# Zipsea Environment Variables Configuration Guide

## Overview
The backend uses environment variables for configuration. All variables are validated on startup using Zod schemas defined in `backend/src/config/environment.ts`.

## Current Status
- ✅ **NODE_ENV**: Set to `staging` (auto-configured in render.yaml)
- ✅ **PORT**: Set to `10000` (auto-configured in render.yaml)
- ✅ **JWT_SECRET**: Auto-generated by Render
- ✅ **WEBHOOK_SECRET**: Auto-generated by Render
- ⏳ **DATABASE_URL**: Will be auto-set when PostgreSQL provisions
- ⏳ **REDIS_URL**: Will be auto-set when Redis provisions
- ❌ **Clerk**: Needs manual configuration
- ❌ **Traveltek**: Needs manual configuration
- ❌ **Sentry**: Optional, add when ready
- ❌ **Resend**: Optional, add when ready

## Required Environment Variables

### 1. Authentication (Clerk)
```bash
CLERK_SECRET_KEY=sk_test_...  # Get from Clerk Dashboard
CLERK_PUBLISHABLE_KEY=pk_test_...  # Get from Clerk Dashboard
```

**Where to get these:**
1. Go to https://dashboard.clerk.com
2. Select your application (or create one)
3. Go to API Keys section
4. Copy the Secret Key and Publishable Key

### 2. Traveltek Integration
```bash
TRAVELTEK_FTP_HOST=ftpeu1prod.traveltek.net
TRAVELTEK_FTP_USER=your_username  # Provided by Traveltek
TRAVELTEK_FTP_PASSWORD=your_password  # Provided by Traveltek
```

**Where to get these:**
- Contact Traveltek for FTP credentials
- Host is confirmed as: `ftpeu1prod.traveltek.net`

### 3. Database (Auto-configured)
```bash
DATABASE_URL=postgresql://...  # Automatically set by Render
```
- This is automatically configured when Render provisions the PostgreSQL database
- No manual action needed

### 4. Redis Cache (Auto-configured)
```bash
REDIS_URL=redis://...  # Automatically set by Render
```
- This is automatically configured when Render provisions Redis
- No manual action needed

### 5. Security (Auto-generated)
```bash
JWT_SECRET=...  # Already auto-generated by Render
WEBHOOK_SECRET=...  # Already auto-generated by Render
```
- These are already configured in render.yaml with `generateValue: true`
- No manual action needed

## Optional Environment Variables

### 6. Error Tracking (Sentry)
```bash
SENTRY_DSN=https://...@sentry.io/...  # Optional
```

**Where to get this:**
1. Go to https://sentry.io
2. Create a new project (Node.js)
3. Copy the DSN from project settings

### 7. Email Service (Resend)
```bash
RESEND_API_KEY=re_...  # Optional, for email functionality
```

**Where to get this:**
1. Go to https://resend.com
2. Sign up and verify your domain
3. Generate an API key

### 8. Other Configuration (Already Set)
```bash
# These are already configured in render.yaml:
NODE_ENV=staging
PORT=10000
CORS_ORIGIN=http://localhost:3000
LOG_LEVEL=info
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

## How to Add Environment Variables in Render

### Method 1: Through Render Dashboard (Recommended)
1. Go to https://dashboard.render.com
2. Select your service: `zipsea-backend`
3. Go to "Environment" tab
4. Click "Add Environment Variable"
5. Add each variable:
   - Key: `CLERK_SECRET_KEY`
   - Value: `sk_test_...` (your actual key)
6. Click "Save Changes"
7. Service will auto-redeploy with new variables

### Method 2: Through render.yaml (For non-sensitive values)
```yaml
envVars:
  - key: VARIABLE_NAME
    value: variable_value
```

### Method 3: Environment Groups (For shared variables)
1. In Render Dashboard, go to "Env Groups"
2. Create a new group (e.g., "zipsea-secrets")
3. Add variables to the group
4. Link the group to your service

## Immediate Action Items

### Step 1: Add Clerk Configuration (Required for Auth)
In Render Dashboard, add:
- `CLERK_SECRET_KEY`: Get from Clerk Dashboard
- `CLERK_PUBLISHABLE_KEY`: Get from Clerk Dashboard

### Step 2: Add Traveltek Credentials (When Provided)
In Render Dashboard, add:
- `TRAVELTEK_FTP_USER`: Your Traveltek username
- `TRAVELTEK_FTP_PASSWORD`: Your Traveltek password
- `TRAVELTEK_FTP_HOST`: `ftpeu1prod.traveltek.net` (already known)

### Step 3: Optional Services (Later)
- `SENTRY_DSN`: For error tracking
- `RESEND_API_KEY`: For email functionality

## Verification

After adding environment variables, verify they're working:

```bash
# Check health endpoint
curl https://zipsea-staging.onrender.com/health

# Check logs in Render Dashboard for any startup errors
```

## Environment Variable Priority

The app currently has these set as **optional** to allow initial deployment:
- DATABASE_URL (optional, but needed for data persistence)
- REDIS_URL (optional, but needed for caching)
- CLERK_SECRET_KEY (optional, but needed for authentication)
- TRAVELTEK_* (optional, but needed for cruise data)

Once you add these variables, the corresponding features will activate.

## Security Notes

⚠️ **Never commit secrets to Git**
- Use Render Dashboard for sensitive values
- Use `generateValue: true` for auto-generated secrets
- Use environment groups for shared secrets

## Troubleshooting

If the app fails to start after adding variables:
1. Check Render logs for validation errors
2. Verify variable names match exactly (case-sensitive)
3. Ensure no trailing spaces in values
4. Check that URLs are properly formatted

## Summary Checklist

### Minimum for Basic Operation:
- [x] NODE_ENV (auto-set to `staging`)
- [x] PORT (auto-set to `10000`)
- [x] JWT_SECRET (auto-generated)
- [x] WEBHOOK_SECRET (auto-generated)

### For Full Functionality:
- [ ] CLERK_SECRET_KEY
- [ ] CLERK_PUBLISHABLE_KEY
- [ ] TRAVELTEK_FTP_USER
- [ ] TRAVELTEK_FTP_PASSWORD
- [ ] DATABASE_URL (auto-set when DB provisions)
- [ ] REDIS_URL (auto-set when Redis provisions)

### Optional Enhancements:
- [ ] SENTRY_DSN
- [ ] RESEND_API_KEY