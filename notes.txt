 5520940052997464
 07/28
 525


curl -X POST "https://zipsea-production.onrender.com/api/webhooks/traveltek/cruiseline-pricing-updated" \
  -H "Content-Type: application/json" \
  -d '{
    "event": "cruiseline_pricing_updated",
    "lineid": 22,
    "marketid": 0,
    "currency": "USD",
    "description": "Manual test webhook",
    "source": "manual_test",
    "timestamp": 1234567890
  }'

psql $DATABASE_URL -c "SELECT MIN(sailing_date), MAX(sailing_date) FROM cruises;"
SYNC_YEAR=2027 SYNC_MONTH=03 node scripts/sync-complete-enhanced.js

  TRAVELTEK_FTP_HOST=ftpeu1prod.traveltek.net
TRAVELTEK_FTP_PASSWORD=m#?jRSY3K$y!9r3?
TRAVELTEK_FTP_USER=CEP_9_USD

# 1. Check data counts
psql $DATABASE_URL -c "
SELECT
  (SELECT COUNT(*) FROM cruises) as cruises,
  (SELECT COUNT(*) FROM cruise_lines) as lines,
  (SELECT COUNT(*) FROM ships) as ships,
  (SELECT COUNT(*) FROM ports) as ports,
  (SELECT COUNT(*) FROM regions) as regions;"

# 2. Verify raw JSON is being stored (MOST IMPORTANT)
psql $DATABASE_URL -c "
SELECT
  COUNT(*) as total_cruises,
  COUNT(raw_data) as has_complete_json,
  AVG(LENGTH(raw_data::text)) as avg_json_size
FROM cruises;"

# 3. Check nested data preservation (2-3 levels deep)
psql $DATABASE_URL -c "
SELECT
  id,
  raw_data->>'name' as name,
  raw_data->'shipcontent'->>'name' as ship_name,
  raw_data->'cheapest'->'combined' IS NOT NULL as has_pricing,
  jsonb_array_length(raw_data->'itinerary') as itinerary_days
FROM cruises
WHERE raw_data IS NOT NULL
LIMIT 3;"

# 4. Verify foreign keys are working
psql $DATABASE_URL -c "
SELECT
  c.id, c.name, cl.name as line, s.name as ship, p.name as port
FROM cruises c
JOIN cruise_lines cl ON c.cruise_line_id = cl.id
JOIN ships s ON c.ship_id = s.id
LEFT JOIN ports p ON c.embarkation_port_id = p.id
LIMIT 3;"



node scripts/test-webhook-batching.js
node scripts/test-webhook-traveltek.js 21 production
curl https://zipsea-production.onrender.com/api/admin/pending-syncs
